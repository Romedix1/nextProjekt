drop table if exists basket;
drop table if exists products;
drop table if exists categories;

create table categories (
    id bigint generated by default as identity primary key,
    name text not null,
    created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

create table products (
    id bigint generated by default as identity primary key,
    name text not null,
    description text,
    price numeric(10, 2) not null check (price >= 0),
    image_url text,
    category_id bigint references categories(id) on delete set null,
    is_bestseller boolean default false,
    created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

create table basket (
    id bigint generated by default as identity primary key,
    product_id bigint references products(id) on delete cascade,
    user_id uuid references auth.users(id) on delete cascade default auth.uid(),
    quantity int default 1 check (quantity > 0),
    created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

insert into categories (name) values ('mezczyzni'), ('kobiety'), ('unisex');

insert into products (name, description, price, image_url, category_id, is_bestseller) values ('Blue de Chanel', 'Klasyczny zapach wolności i elegancji.', 450.00, 'https://images.unsplash.com/photo-1523293182086-7651a899d37f?w=500', 1, true), ('Sauvage Dior', 'Surowy, szlachetny i niezwykle trwały.', 380.50, 'https://images.unsplash.com/photo-1541643600914-78b084683601?w=500', 1, true), ('Acqua di Gio', 'Ikona świeżości inspirowana morzem.', 320.00, 'https://images.unsplash.com/photo-1592945403244-b3fbafd7f539?w=500', 1, false), ('Versace Eros', 'Mocna, świeża i orientalna kompozycja.', 290.00, 'https://images.unsplash.com/photo-1557170334-a9632e77c6e4?w=500', 1, false), ('Terre d''Hermès', 'Zapach oparty na alchemii drewna i ziemi.', 415.00, 'https://images.unsplash.com/photo-1615394441553-4681e8446058?w=500', 1, true), ('La Vie Est Belle', 'Najpiękniejszy zapach szczęścia dla kobiet.', 410.00, 'https://images.unsplash.com/photo-1594035910387-fea47794261f?w=500', 2, true), ('Black Opium', 'Zmysłowy miks kawy, wanilii i białych kwiatów.', 395.00, 'https://images.unsplash.com/photo-1590736704728-f4730bb30770?w=500', 2, true), ('Si Passione', 'Intensywny i bezkompromisowy zapach miłości.', 430.00, 'https://images.unsplash.com/photo-1541108564883-b91358006a15?w=500', 2, false), ('J''adore Dior', 'Kwiatowy bukiet zamknięty w legendarnym flakonie.', 480.00, 'https://images.unsplash.com/photo-1585232356846-53c4b6686ff2?w=500', 2, true), ('Chanel No. 5', 'Esencja kobiecości, ponadczasowy symbol luksusu.', 520.00, 'https://images.unsplash.com/photo-1547887538-e3a2f32cb1cc?w=500', 2, false), ('Tom Ford Lost Cherry', 'Słodki i zuchwały zapach wiśni i likieru.', 950.00, 'https://images.unsplash.com/photo-1595428774223-ef52624120d2?w=500', 3, true), ('Byredo Bal d''Afrique', 'Energetyczny miks afrykańskich kwiatów i drewna.', 680.00, 'https://images.unsplash.com/photo-1594035910387-fea47794261f?w=500', 3, true), ('Le Labo Santal 33', 'Kultowy zapach kardamonu i drzewa sandałowego.', 820.00, 'https://images.unsplash.com/photo-1523293182086-7651a899d37f?w=500', 3, false), ('CK One', 'Przełomowy zapach, który nie zna płci.', 180.00, 'https://images.unsplash.com/photo-1541643600914-78b084683601?w=500', 3, false), ('Molecule 01', 'Zapach oparty na jednej, unikalnej molekule.', 350.00, 'https://images.unsplash.com/photo-1592945403244-b3fbafd7f539?w=500', 3, true);

CREATE POLICY "Users can view their own basket" ON basket FOR SELECT USING (auth.uid() = user_id);